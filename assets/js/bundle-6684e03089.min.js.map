{"version":3,"sources":["node_modules/browser-pack/_prelude.js","app/SpaceApp.js","common/js/CindyApp.js","common/js/application.js","src/js/main.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","_CindyApp2","SpaceApp","config","arguments","undefined","_classCallCheck","this","_super","Object","assign","defaultConfig","wrap","convertLevelFormat","shuffledLevels","numLevels","setLengths","levelSets","map","set","Array","fill","v","k","setIndex","Math","floor","levelIndex","random","level","levelstr","objects","robot","lines","split","j","push","SIZE","concat","ctype","value","real","imag","_typeof","relativeUrl","filename","levelFileUrls","l","Promise","all","levelUrl","request","url","levelFiles","levelRegExp","processLevelFile","match","CindyJS","registerPlugin","api","defineFunction","args","evaluate","levels","_this","canvas","style","backgroundImage","backgroundSize","loadScripts","name","type","pos","pinned","color","visible","size","narrow","element","virtualheight","virtualwidth","transform","visibleRect","target","o1","o2","o3","o4","o5","o6","o7","o8","o9","o10","selected","scripts","geometry","ports","images","autoplay","behavior","use","appName","appDescription","appCredits","pauseScript","resumeScript","_application","CindyApp","_thisSuper","console","log","_isCindyPaused","_cindy","cindyArgs","_cindyAppReadyPromise","_get","_assertThisInitialized","_getPrototypeOf","prototype","then","waitForDomInsertion","document","body","_asyncToGenerator","regeneratorRuntime","mark","_callee","_context","prev","next","assert","clientWidth","clientHeight","t0","t1","sent","newInstance","startup","abrupt","stop","_cindyPromise","constructor","_isReady","cindy","pause","evokeCS","play","resetScript","_canvas","createElement","width","height","_cindyArgs","_initCindyArgs","baseUrl","URL","href","jsonText","JSON","parse","obj","resolve","reject","xhr","XMLHttpRequest","open","method","headers","keys","forEach","key","setRequestHeader","onload","status","response","onerror","send","prefix","infixes","suffix","promises","infix","scriptText","_iterator","s","_step","done","_loop","root","observer","parentElement","MutationObserver","contains","disconnect","observe","childList","subtree","_configOverridesPromises","Application","_config","_applicationReadyPromise","ready","isReady","pauseAfterRestart","reset","resume","_domElement","retrieveConfigOverrides","_SpaceApp","$","each","_","container","game","append","domElement"],"mappings":"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","file":"bundle-6684e03089.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import CindyApp from \"../common/js/CindyApp.js\";\n\nclass SpaceApp extends CindyApp {\n  constructor(config = {}) {\n    super(Object.assign(SpaceApp.defaultConfig, config));\n  }\n\n  static get defaultConfig() {\n    return {\n      appName: 'Space Rescue',\n      appDescription: 'Die Astronautin und die Robosatelliten können im Weltall jeweils so weit nach oben, rechts, unten oder links fliegen, bis sie aneinander stoßen. Wie kann die Astronautin in ihr Raumschiff gelangen?',\n      appCredits: 'Level & Implemtierung: Aaron Montag. Spielidee inspiriert von Hiroshi Yamamoto.',\n      pauseScript: '',\n      resumeScript: '',\n      numLevels: 10\n    };\n  }\n\n  async _initCindyArgs() {\n    const relativeUrl = filename => `app/${filename}`;\n    const SIZE = 7;\n\n    const levelFileUrls = [\n      \"beginner-1\",\n      \"beginner-2\",\n      \"easy-1\",\n      \"easy-2\",\n      \"medium-1\",\n      \"medium-2\",\n      \"hard\",\n      \"extreme\"\n    ].map(l => relativeUrl(`levels/${l}.txt`));\n    const levelFiles = await Promise.all(levelFileUrls.map(levelUrl => CindyApp.request({url: levelUrl})));\n\n    // filter out invalid lines and parse level files\n    const whitespaceRegExp = /\\s+/g;\n    const levelRegExp = /([\\.oS]{7}\\n){6}([\\.oS]{7})/g;\n\n    const processLevelFile = f => f.match(levelRegExp);\n    const levelSets = levelFiles.map(processLevelFile);\n\n    function wrap(v) { //converts js-lists of lists of real numbers to CS-object.\n      if (typeof v === \"number\") {\n        return {\n          \"ctype\": \"number\",\n          \"value\": {\n            'real': v,\n            'imag': 0\n          }\n        };\n      } else if (typeof v === \"object\" && v.length !== undefined) {\n        return {\n          \"ctype\": \"list\",\n          \"value\": v.map(wrap)\n        }\n      }\n    }\n\n    function convertLevelFormat(levelstr) {\n      let objects = [];\n      let robot = [1, 1];\n      let lines = levelstr.split('\\n');\n      for (let j = 0; j < lines.length; j++) {\n        for (let i = 0; i < lines[j].length; i++) {\n          let c = lines[i][j];\n          if (c === 'o')\n            objects.push([i + 1, SIZE - j]);\n          else if (c === 'S')\n            robot = [i + 1, SIZE - j];\n        }\n      }\n      return [robot].concat(objects);\n    }\n\n    function shuffledLevels(numLevels) {\n      // keep start index for each set to to avoid selecting the same level twice\n      const setLengths = levelSets.map(set => set.length);\n      const levels = new Array(numLevels).fill(0).map((v, k) => {\n        const setIndex = Math.floor((k * (levelSets.length)) / (numLevels));\n        const set = levelSets[setIndex];\n        if (setLengths[setIndex] > 0) {\n          // select a random level and move it to the end of the set to avoid returning duplicate levels\n          const levelIndex = Math.floor(Math.random() * setLengths[setIndex]);\n          const level = set[levelIndex];\n          set[levelIndex] = set[setLengths[setIndex] - 1];\n          set[setLengths[setIndex] - 1] = level;\n          setLengths[setIndex]--;\n          return level;\n        } else {\n          // can not select levels without having duplicates, so just choose a random one\n          if (levelSets.length === 0) {\n            throw new Error(\"Space Rescue level set is empty\");\n          } else {\n            return set[Math.floor(Math.random() * set.length)];\n          }\n        }\n      });\n      return levels;\n    }\n\n    CindyJS.registerPlugin(1, \"spacelevels\", (api) => {\n      api.defineFunction(\"getshuffledlevels\", 1, (args) => {\n        const numLevels = api.evaluate(args[0]).value.real | 0;\n        const levels = shuffledLevels(numLevels);\n        return wrap(levels.map(level => convertLevelFormat(level)));\n      });\n      api.defineFunction(\"getshuffledlevels\", 0, (args) => {\n        const levels = shuffledLevels(this.config.numLevels);\n        return wrap(levels.map(level => convertLevelFormat(level)));\n      });\n    });\n\n\n    this.canvas.style.backgroundImage = `url('${relativeUrl(\"img/background.jpg\")}')`;\n    this.canvas.style.backgroundSize = \"cover\";\n\n    return {\n      scripts: await CindyApp.loadScripts(relativeUrl('Space_'), ['init', 'draw', 'mousedown', 'mouseup'], '.cs'),\n      geometry: [{\n          name: \"P0\",\n          type: \"Free\",\n          pos: [SIZE + 1.7, 2.5],\n          pinned: true,\n          color: [1, 0, 0],\n          visible: false\n        },\n        {\n          name: \"P1\",\n          type: \"Free\",\n          pos: [SIZE + 1.7, SIZE+0.5],\n          pinned: true,\n          color: [1, 0, 0],\n          visible: false\n        },\n        {\n          name: \"seg\",\n          type: \"Segment\",\n          args: [\"P0\", \"P1\"],\n          pos: [1, 0, 0],\n          size: 3,\n          color: [1, 1, 1]\n        },\n        {\n          name: \"P2\",\n          type: \"PointOnSegment\",\n          args: [\"seg\"],\n          pos: [SIZE + 2, 1.2],\n          narrow: 100,\n          size: 11,\n          color: [1, 1, 1]\n        },\n      ],\n      ports: [{\n        element: this.canvas,\n        virtualheight: 750,\n        virtualwidth: 1000,\n        transform: [{\n          visibleRect: [0.2, SIZE + 1.3, SIZE + 2.6, -0.3]\n        }]\n      }],\n      images: {\n        target: relativeUrl(\"img/target.png\"),\n        o1: relativeUrl(\"img/o1.png\"),\n        o2: relativeUrl(\"img/o2.png\"),\n        o3: relativeUrl(\"img/o3.png\"),\n        o4: relativeUrl(\"img/o4.png\"),\n        o5: relativeUrl(\"img/o5.png\"),\n        o6: relativeUrl(\"img/o6.png\"),\n        o7: relativeUrl(\"img/o7.png\"),\n        o8: relativeUrl(\"img/o8.png\"),\n        o9: relativeUrl(\"img/o9.png\"),\n        o10: relativeUrl(\"img/o10.png\"),\n        selected: relativeUrl(\"img/selected.png\")\n      },\n      autoplay: true,\n      behavior: [],\n      use: [\"spacelevels\"]\n    };\n  }\n}\n\nexport default SpaceApp;\n","import Application from './application.js';\n\nclass CindyApp extends Application {\n    constructor(config = {}) {\n        super(Object.assign(CindyApp.defaultConfig, config));\n        console.log(\"CindyApp called\");\n        this._isCindyPaused = false;\n        this._cindy = null;\n\n        // trigger loading of cindy arguments\n        const cindyArgs = this.cindyArgs;\n\n        this._cindyAppReadyPromise = super.ready\n            .then(() => CindyApp.waitForDomInsertion(this.canvas, document.body))\n            .then(async () => {\n                console.assert(this.canvas.clientWidth !== 0, 'canvas has 0 clientWidth');\n                console.assert(this.canvas.clientHeight !== 0, 'canvas has 0 clientHeight');\n                this._cindy = CindyJS.newInstance(await cindyArgs);\n                this._cindy.startup();\n                return this;\n            });\n        // for backwards compatibility; should not be used anymore\n        this._cindyPromise = this._cindyAppReadyPromise.then(() => this._cindy);\n    }\n\n    static get defaultConfig() {\n        return {\n            appName: 'CindyJS app',\n            pauseScript: 'pause();',\n            resumeScript: 'resume();',\n            resetScript: 'reset();',\n        };\n    }\n\n    static async retrieveConfigOverridesJsonByClass(baseUrl) {\n        const url = new URL(this.name + 'Overrides.json', baseUrl).href;\n        const jsonText = await CindyApp.request({url: url});\n        if (typeof jsonText === 'string')\n            return JSON.parse(jsonText);\n        else if (typeof jsonText === 'object')\n            return jsonText;\n        else\n            throw new Error(`Error processing config override file ${url}`);\n    }\n\n    static async request(obj) {\n        return new Promise((resolve, reject) => {\n            let xhr = new XMLHttpRequest();\n            xhr.open(obj.method || \"GET\", obj.url);\n            if (obj.headers) {\n                Object.keys(obj.headers).forEach(key => {\n                    xhr.setRequestHeader(key, obj.headers[key]);\n                });\n            }\n            xhr.onload = () => {\n                if (xhr.status >= 200 && xhr.status < 300) {\n                    resolve(xhr.response);\n                } else {\n                    reject(xhr);\n                }\n            };\n            xhr.onerror = () => reject(xhr);\n            xhr.send(obj.body);\n        });\n    }\n\n    static async loadScripts(prefix, infixes, suffix) {\n        const scripts = {};\n        const promises = [];\n        // TODO: error handling for failed loads\n        for (let infix of infixes)\n            promises.push(CindyApp.request({url: prefix + infix + suffix}).then(scriptText => scripts[infix] = scriptText));\n        await Promise.all(promises);\n        return scripts;\n    }\n\n    get canvas() {\n        if (typeof this._canvas === 'undefined') {\n            this._canvas = document.createElement('canvas');\n            this._canvas.width = 1560;\n            this._canvas.height = 1170;\n        }\n        return this._canvas;\n    }\n\n    get cindyReady() {\n        return this._cindyPromise;\n    }\n\n    get cindy() {\n        return this._cindy;\n    }\n\n    get cindyArgs() {\n        if (typeof this._cindyArgs === 'undefined')\n            this._cindyArgs = this._initCindyArgs();\n        return this._cindyArgs;\n    }\n\n    async _initCindyArgs() {\n        throw new Error(`Unimplemented. Must be implemented in subclass ${this.constructor.name}.`);\n    }\n\n    static async waitForDomInsertion(element, root) {\n        return new Promise(resolve => {\n            if (element.parentElement === null) {\n                // resolve after insertion of the element into the given DOM subtree\n                const observer = new MutationObserver(() => {\n                    if (root.contains(element)) {\n                        observer.disconnect();\n                        resolve();\n                    }\n                });\n                observer.observe(root, {childList: true, subtree: true});\n            } else {\n                // resolve immediately\n                resolve();\n            }\n        });\n    }\n\n    get ready() {\n        return this._cindyAppReadyPromise;\n    }\n\n    get domElement() {\n        return this.canvas;\n    }\n\n    pause() {\n        super.pause();\n        if (this._isReady) {\n            this.cindy.pause();\n            this._isCindyPaused = true;\n            this.cindy.evokeCS(this.config.pauseScript);\n        }\n    }\n\n    resume() {\n        super.resume();\n        if (this._isReady) {\n            this.cindy.play();\n            this._isCindyPaused = false;\n            this.cindy.evokeCS(this.config.resumeScript);\n        }\n    }\n\n    reset() {\n        super.reset();\n        if (this._isReady) {\n            this.cindy.stop()\n            if (!this._isCindyPaused)\n                this.cindy.play();\n            this.cindy.evokeCS(this.config.resetScript);\n        }\n    }\n}\n\nexport default CindyApp;\n","const _configOverridesPromises = {};\n\nclass Application {\n    constructor(config = {}) {\n        this._config = Object.assign(Application.defaultConfig, config);\n\n        this._applicationReadyPromise = Promise.resolve();\n        this._isReady = false;\n\n        // the this.ready might be overwritten by a superclass, so we only query it after the stack has become empty\n        Promise.resolve().then(() => this.ready.then(() => this._isReady = true));\n    }\n\n    static get defaultConfig() {\n        return {\n            appName: 'App name',\n            appDescription: '',\n            appCredits: '',\n        };\n    }\n\n    static async retrieveConfigOverrides() {\n        return Promise.resolve([]);\n    }\n\n    /***\n     * This method returns an array of config overrides for the class in question.\n     * The format is `{type:'..', config: {...}}`. `type` determines how to interpret the override such that an\n     * application can check whether the override applies or not. If it does, `config` contains the properties\n     * to override. Several overrides may or may not be combined when passing them to the class constructor.\n     */\n    static async getConfigOverrides() {\n        if (typeof _configOverridesPromises[this.name] === 'undefined')\n            _configOverridesPromises[this.name] = this.retrieveConfigOverrides(); // when overwritten in a subclass, it will be called on the subclass\n        return _configOverridesPromises[this.name];\n    }\n\n    get isReady() {\n        return this._isReady;\n    }\n\n    get ready() {\n        return this._applicationReadyPromise;\n    }\n\n    get domElement() {\n        if (typeof this._domElement === 'undefined')\n            this._domElement = document.createElement('div');\n        return this._domElement;\n    }\n\n    get config() {\n        return this._config;\n    }\n\n    get name() {\n        return this._config.appName;\n    }\n\n    get description() {\n        return this._config.appDescription;\n    }\n\n    get credits() {\n        return this._config.appCredits;\n    }\n\n    pause() {\n        if (this.isReady) {\n            console.log(`pausing ${this.constructor.name}`);\n        } else {\n            console.log(`pausing ${this.constructor.name} failed, because app is not ready yet`);\n        }\n    }\n\n    resume() {\n        if (this.isReady) {\n            console.log(`resuming ${this.constructor.name}`);\n        } else {\n            console.log(`resuming ${this.constructor.name} failed, because app is not ready yet`);\n        }\n    }\n\n    reset() {\n        if (this.isReady) {\n            console.log(`resetting ${this.constructor.name}`);\n        } else {\n            console.log(`resetting ${this.constructor.name} failed, because app is not ready yet`);\n        }\n    }\n\n    restart(pauseAfterRestart) {\n        this.reset();\n        if (pauseAfterRestart)\n            this.pause();\n        else\n            this.resume();\n    }\n}\n\nexport default Application;\n","import SpaceApp from '../../app/SpaceApp';\n\n$('[data-component=game]').each((_, container) => {\n  const game = new SpaceApp();\n  $(container).append(game.domElement);\n});\n\n"]}